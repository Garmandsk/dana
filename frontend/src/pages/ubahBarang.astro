---
if ((!Astro.cookies.has('sessionFE')) || (!Astro.cookies.has('sessionBE'))) {
  return Astro.redirect("/");
}

import { API_BE } from "astro:env/client";

if (Astro.request.method === "POST") {
  if((!Astro.cookies.has("sessionFE")) || (!Astro.cookies.has("sessionBE"))){
    return Astro.redirect("/error/500");
  }
  const formData = await Astro.request.formData();
  const idRiwayat = formData.get("idRiwayat");
  const idBarang = formData.get("idBarang");
  const hargaBarang = formData.get("hargaBarang");
  const jumlahBarang = formData.get("jumlahBarang");
  const responseUbahBarang = await fetch(`${API_BE}/barang-ubah/${idBarang}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({hargaBarang, jumlahBarang})
  });
  
  console.log(responseUbahBarang);
  
  const resultUbahBarang = await responseUbahBarang.json();
  console.log(resultUbahBarang);
  if(resultUbahBarang.status === "success"){
    return Astro.redirect(`/ubahRiwayat/${idRiwayat}`);
  }else{
    return Astro.redirect("/gagal");
  }
}
---