---
import { API_URL_HAPI } from "astro:env/client";

if (Astro.request.method === "POST") {
  const formData = await Astro.request.formData();
  const idRiwayat = formData.get("idRiwayat");  // Ambil idRiwayat dari formData
  console.log(idRiwayat)
  if (!idRiwayat) {
    console.error("ID Riwayat tidak ditemukan: ", idRiwayat);
    return Astro.redirect("/gagal");
  }

  const responseHapusRiwayat = await fetch(`${API_URL_HAPI}/riwayat-hapus/${idRiwayat}`, {
    method: "DELETE",
  });

  const resultHapusRiwayat = await responseHapusRiwayat.json();
  console.log(resultHapusRiwayat);

  if (resultHapusRiwayat.status === "success") {
    return Astro.redirect("/riwayat");
  } else {
    console.log(resultHapusRiwayat)
    return Astro.redirect("/gagal");
  }
}
---